<div class="panel">
  <!-- Header Compacto -->
  <header class="header">
    <div class="header__left">
      <app-logo size="md" />
    </div>
    <div class="header__center">
      <div class="clock">
        <span class="clock__time">{{ currentTime }}</span>
        <span class="clock__date">{{ currentDate }}</span>
      </div>
    </div>
    <div class="header__right">
      <app-theme-toggle />
      <button class="logout-btn" (click)="logout()" title="Sair">
        <app-icon name="log-out" [size]="22" />
      </button>
    </div>
  </header>

  <!-- Welcome Section -->
  <section class="welcome">
    <app-avatar 
      [name]="(user?.name || '') + ' ' + (user?.lastName || '')" 
      [imageUrl]="user?.avatar"
      size="xl"
      class="welcome__avatar"
    />
    <div class="welcome__text">
      <h1 class="welcome__greeting">{{ getGreeting() }}, {{ user?.name }}!</h1>
      <p class="welcome__role">Painel do Profissional</p>
    </div>
  </section>

  <!-- Stats Quick View -->
  @if (stats) {
    <section class="quick-stats">
      <div class="stat-card stat-card--blue">
        <app-icon name="calendar" [size]="28" />
        <div class="stat-card__content">
          <span class="stat-card__value">{{ stats.todayAppointments }}</span>
          <span class="stat-card__label">Consultas Hoje</span>
        </div>
      </div>
      <div class="stat-card stat-card--green">
        <app-icon name="clock" [size]="28" />
        <div class="stat-card__content">
          <span class="stat-card__value">{{ stats.weekAppointments }}</span>
          <span class="stat-card__label">Semana</span>
        </div>
      </div>
      <div class="stat-card stat-card--purple">
        <app-icon name="x-circle" [size]="28" />
        <div class="stat-card__content">
          <span class="stat-card__value">{{ stats.pendingBlocks }}</span>
          <span class="stat-card__label">Bloqueios</span>
        </div>
      </div>
      <div class="stat-card stat-card--orange">
        <app-icon name="bell" [size]="28" />
        <div class="stat-card__content">
          <span class="stat-card__value">{{ stats.unreadNotifications }}</span>
          <span class="stat-card__label">Notificações</span>
        </div>
      </div>
    </section>
  }

  <!-- Consultas Aguardando o Médico -->
  @if (waitingConsultations.length > 0) {
    <section class="waiting-section">
      <div class="waiting-section__header">
        <app-icon name="alert-circle" [size]="24" class="pulse-icon" />
        <h2 class="waiting-section__title">Pacientes Aguardando Você</h2>
        <span class="waiting-section__count">{{ waitingConsultations.length }}</span>
      </div>
      <div class="waiting-section__cards">
        @for (consultation of waitingConsultations; track consultation.id) {
          <div class="waiting-card">
            <div class="waiting-card__avatar">
              <app-avatar 
                [name]="consultation.patientName" 
                [imageUrl]="consultation.patientAvatar ?? undefined"
                size="lg"
              />
            </div>
            <div class="waiting-card__info">
              <h3 class="waiting-card__name">{{ consultation.patientName }}</h3>
              <div class="waiting-card__details">
                @if (consultation.patientSex) {
                  <span class="detail-badge">{{ formatSex(consultation.patientSex) }}</span>
                }
                @if (calculateAge(consultation.patientBirthDate)) {
                  <span class="detail-badge">{{ calculateAge(consultation.patientBirthDate) }} anos</span>
                }
                <span class="detail-badge specialty">{{ consultation.specialtyName }}</span>
              </div>
              <div class="waiting-card__time">
                <app-icon name="clock" [size]="14" />
                <span>Aguardando há {{ consultation.waitingMinutes }} minuto(s)</span>
              </div>
            </div>
            <button 
              class="waiting-card__btn"
              (click)="enterConsultation(consultation)"
              type="button"
            >
              <app-icon name="video" [size]="20" />
              Entrar na Consulta
            </button>
          </div>
        }
      </div>
    </section>
  }

  <!-- Main Control Panel Grid -->
  <section class="buttons-grid">
    @for (button of panelButtons; track button.id) {
      <button 
        class="control-btn"
        [class.control-btn--green]="button.color === 'green'"
        [class.control-btn--blue]="button.color === 'blue'"
        [class.control-btn--red]="button.color === 'red'"
        [class.control-btn--purple]="button.color === 'purple'"
        [class.control-btn--orange]="button.color === 'orange'"
        (click)="button.isLogout ? logout() : navigateTo(button.route)"
        type="button"
      >
        <div class="control-btn__icon">
          <app-icon [name]="button.icon" [size]="40" />
        </div>
        <span class="control-btn__title">{{ button.title }}</span>
        <span class="control-btn__desc">{{ button.description }}</span>
        @if (button.stats !== undefined) {
          <span class="control-btn__badge">{{ button.stats }}</span>
        }
      </button>
    }
    <!-- Card decorativo para preencher espaço vazio (8º espaço no grid 4x2) -->
    <div class="branding-card" aria-hidden="true">
      <img src="favicon.ico" alt="" class="branding-card__logo" />
      <span class="branding-card__text">TeleCuidar</span>
      <span class="branding-card__tagline">Telemedicina Humanizada</span>
    </div>
  </section>
</div>
