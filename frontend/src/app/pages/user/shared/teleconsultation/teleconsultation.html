<div class="teleconsultation-container">
  <!-- Overlay de modo ditado do médico (apenas para paciente) -->
  <div class="dictation-overlay" *ngIf="isDoctorDictating && userrole === 'PATIENT'">
    <div class="dictation-message">
      <app-icon name="mic" [size]="32" />
      <h3>Só um instante</h3>
      <p>O médico está digitando...</p>
    </div>
  </div>

  <!-- Wrapper para conteúdo + barra de status -->
  <div class="teleconsultation-body">
    <!-- Main Content (Video + Header) -->
    <div class="main-content" [class.sidebar-open]="isSidebarOpen && !isSidebarFull" [class.full-screen]="isSidebarOpen && isSidebarFull">
    <!-- Header -->
    <div class="tele-header dark-header" [class.hidden]="!isHeaderVisible">
      <div class="header-content">
        <!-- LAYOUT PARA PROFESSIONAL: Header simplificado -->
        <ng-container *ngIf="userrole === 'PROFESSIONAL'">
          <div class="controls-section controls-left">
            <app-button variant="danger" size="sm" (click)="exitCall()">
              <app-icon name="log-out" [size]="18" />
              Sair da consulta
            </app-button>
          </div>

          <div class="controls-section controls-right">
            <app-button variant="primary" size="sm" (click)="toggleSidebar()" *ngIf="!isSidebarOpen">
              <app-icon name="edit" [size]="18" />
              Registros da Consulta
            </app-button>
          </div>
        </ng-container>

        <!-- LAYOUT PARA PATIENT/ASSISTANT/ADMIN: Header simplificado -->
        <ng-container *ngIf="userrole !== 'PROFESSIONAL'">
          <div class="info-section">
            <!-- Info está na barra de sinais vitais -->
          </div>

          <div class="controls-section">
            <app-button variant="primary" size="sm" (click)="toggleSidebar()" *ngIf="!isSidebarOpen">
              <app-icon name="folder" [size]="18" />
              Enviar e receber arquivos
            </app-button>
            <app-button variant="danger" size="sm" (click)="exitCall()">
              Finalizar Consulta
            </app-button>
          </div>
        </ng-container>
      </div>
    </div>

    <!-- Video Area with Jitsi Integration -->
    <div class="video-area">
      <!-- Jitsi Video Component (quando habilitado) -->
      <app-jitsi-video
        *ngIf="jitsiEnabled && appointmentId"
        [appointmentId]="appointmentId"
        [showControls]="true"
        (conferenceJoined)="onConferenceJoined($event)"
        (conferenceLeft)="onConferenceLeft($event)"
        (errorOccurred)="onJitsiError($event)"
        (callEnded)="onCallEnded()">
      </app-jitsi-video>

      <!-- Placeholder quando Jitsi não está habilitado -->
      <div class="placeholder-video" *ngIf="!jitsiEnabled">
        <app-icon name="video" [size]="64" />
        <p>Sistema de Videochamada</p>
        <p class="placeholder-subtitle" *ngIf="!jitsiEnabled">Jitsi não configurado. Configure o servidor Jitsi para habilitar videochamadas.</p>
        <div class="controls-overlay" *ngIf="!isHeaderVisible">
          <button class="icon-btn show-header-btn" (click)="toggleHeader()" title="Mostrar Cabeçalho">
            <app-icon name="chevron-down" [size]="24" />
          </button>
        </div>
      </div>

      <!-- Controls overlay para mostrar header quando Jitsi está ativo -->
      <div class="controls-overlay" *ngIf="jitsiEnabled && !isHeaderVisible">
        <button class="icon-btn show-header-btn" (click)="toggleHeader()" title="Mostrar Cabeçalho">
          <app-icon name="chevron-down" [size]="24" />
        </button>
      </div>
    </div>

  </div>

  <!-- Sidebar -->
  <app-teleconsultation-sidebar
    [isOpen]="isSidebarOpen"
    [isFullScreen]="isSidebarFull"
    [isHeaderVisible]="isHeaderVisible"
    [tabs]="currentTabs"
    [activeTab]="activeTab"
    [userrole]="userrole"
    [appointmentId]="appointmentId"
    [appointment]="appointment"
    [patientData]="patientData"
    [preConsultationData]="preConsultationData"
    [anamnesisData]="anamnesisData"
    [biometricsData]="biometricsData"
    [soapData]="soapData"
    [specialtyFieldsData]="specialtyFieldsData"
    (toggle)="toggleSidebar()"
    (toggleMode)="toggleSidebarMode()"
    (toggleHeader)="toggleHeader()"
    (tabChange)="setActiveTab($event)"
    (finishConsultation)="onFinishConsultation($event)">
  </app-teleconsultation-sidebar>
  </div>

  <!-- Barra de Status de Sinais Vitais (rodapé fixo - LARGURA TOTAL) -->
  <div class="vitals-footer-wrapper">
    <app-vitals-status-bar
      [appointmentId]="appointmentId"
      [appointment]="appointment"
      [userRole]="userrole">
    </app-vitals-status-bar>
  </div>
</div>
